<?xml version='1.0'?>

<robot name="udacity_bot" xmlns:xacro="http://www.ros.org/wiki/xacro">

 <!-- ################### XACRO Definitions ############################# -->
 <!-- ################### XACRO Definitions ############################# -->
 <!-- ################### XACRO Definitions ############################# -->
 <!-- ################### XACRO Definitions ############################# -->

 <xacro:macro name="zero_origin">
     <origin xyz="0 0 0" rpy="0 0 0" />
 </xacro:macro>

<xacro:macro name="wheel_link_origin">
    <origin xyz="0 0 0" rpy="0 1.5707 1.5707" />
</xacro:macro>

<xacro:macro name="default_inertia">
    <inertia
        ixx="0.1" ixy="0" ixz="0"
        iyy="0.1" iyz="0"
        izz="0.1"
      />
</xacro:macro>


<!-- ################### MACRO Generators ############################# -->
<!-- ################### MACRO Generators ############################# -->
<!-- ################### MACRO Generators ############################# -->
<!-- ################### MACRO Generators ############################# -->


<xacro:macro name="generate_geometry" params="shape radius=0 length=0 x=0 y=0 z=0">
<!--UNITS IN METERS-->
<!--<cylinder radius="" length=""/>-->
<!--<box x="" y="" z="" />-->
<!--<sphere radius=""/> -->

    <geometry>
        
        <xacro:if value="${shape == 'box'}">
            <box size="${x} ${y} ${z}"/>
        </xacro:if>
        <xacro:if value="${shape == 'cylinder'}">
            <cylinder length="${length}" radius="${radius}"/>
        </xacro:if>
        <xacro:if value="${shape == 'sphere'}">
            <sphere radius="${radius}"/>
        </xacro:if>
        
    </geometry>
    
</xacro:macro>


<xacro:macro name="generate_wheel_link" params="side">
    <link name="${side}_wheel">
       <inertial>
           <xacro:wheel_link_origin/>
           <mass value="5"/>
           <xacro:default_inertia/>
       </inertial>
       <collision>
             <xacro:wheel_link_origin/>
             <xacro:generate_geometry shape="cylinder" radius="0.1" length="0.05" />
       </collision>
       <visual>
             <xacro:wheel_link_origin/>
             <xacro:generate_geometry shape="cylinder" radius="0.1" length="0.05" />
       </visual>
   </link>
</xacro:macro>


<xacro:macro name="generate_wheel_joint" params="side">
    <joint type="continuous" name="${side}_wheel_hinge">

        <xacro:if value="${side == 'left'}">
            <origin xyz="0 0.15 0" rpy="0 0 0"/>
        </xacro:if>

        <xacro:if value="${side == 'right'}">
            <origin xyz="0 -0.15 0" rpy="0 0 0"/>
        </xacro:if>
        
        <parent link="chassis"/>
        <child link="${side}_wheel"/>
        <axis xyz="0 1 0" rpy="0 0 0"/>
        <limit effort="10000" velocity="1000"/>
        <dynamics damping="1.0" friction="1.0"/>
    </joint>
</xacro:macro>


 <!-- ################### ROBOT Definitions ############################# -->
 <!-- ################### ROBOT Definitions ############################# -->
 <!-- ################### ROBOT Definitions ############################# -->
 <!-- ################### ROBOT Definitions ############################# -->

  <link name="robot_footprint"></link>

  <joint name="robot_footprint_joint" type="fixed">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <parent link="robot_footprint"/>
      <child link="chassis" />
  </joint>

  <link name='chassis'>
      <pose>0 0 0.1 0 0 0</pose>

      <inertial>
          <mass value="15.0"/>
          <origin xyz="0.0 0 0" rpy=" 0 0 0"/>
          <xacro:default_inertia/>
    </inertial>

    <collision name='collision'>
        <xacro:zero_origin/> 
        <geometry>
            <box size=".4 .2 .1"/>
        </geometry>
    </collision>

    <visual name='chassis_visual'>
        <xacro:zero_origin/>
        <geometry>
            <box size=".4 .2 .1"/>
        </geometry>
    </visual>

    <collision name='back_caster_collision'>
        <origin xyz="-0.15 0 -0.05" rpy=" 0 0 0"/>
        <geometry>
            <sphere radius="0.0499"/>
        </geometry>
    </collision>

    <visual name='back_caster_visual'>
        <origin xyz="-0.15 0 -0.05" rpy=" 0 0 0"/>
        <geometry>
            <sphere radius="0.05"/>
        </geometry>
    </visual>

    <collision name='front_caster_collision'>
        <origin xyz="0.15 0 -0.05" rpy=" 0 0 0"/>
        <geometry>
            <sphere radius="0.0499"/>
        </geometry>
    </collision>

    <visual name='front_caster_visual'>
        <origin xyz="0.15 0 -0.05" rpy=" 0 0 0"/>
        <geometry>
            <sphere radius="0.05"/>
        </geometry>
    </visual>
    
  </link>

  <xacro:generate_wheel_link side="right"/>
  <xacro:generate_wheel_link side="left"/>

  <xacro:generate_wheel_joint side="right"/>
  <xacro:generate_wheel_joint side="left"/>


</robot>